<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Party üéµ v4.0</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <link href="https://fonts.googleapis.com/css2?family=Bungee+Shade&family=Montserrat:wght@600;800&display=swap" rel="stylesheet">
</head>
<body>
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ===========================================
        // D√âTECTION FILMS INTELLIGENTE (sans API)
        // ===========================================
        const FILM_KEYWORDS = {
            // Harry Potter
            "harry": "Harry Potter", "potter": "Harry Potter", "hogwarts": "Harry Potter",
            "hedwig": "Harry Potter", "dumbledore": "Harry Potter", "lily": "Harry Potter",
            
            // Star Wars
            "star wars": "Star Wars", "imperial": "Star Wars", "force": "Star Wars",
            "vader": "Star Wars", "skywalker": "Star Wars", "duel of fates": "Star Wars",
            
            // Disney
            "frozen": "La Reine des Neiges", "let it go": "La Reine des Neiges",
            "lion king": "Le Roi Lion", "circle of life": "Le Roi Lion", "hakuna": "Le Roi Lion",
            "aladdin": "Aladdin", "whole new world": "Aladdin",
            "beauty beast": "La Belle et la B√™te", "belle": "La Belle et la B√™te",
            "moana": "Vaiana", "how far i'll go": "Vaiana",
            "encanto": "Encanto", "we don't talk about bruno": "Encanto",
            "coco": "Coco", "remember me": "Coco",
            
            // Titanic
            "titanic": "Titanic", "my heart will go on": "Titanic", "celine dion": "Titanic",
            
            // James Bond
            "bond": "James Bond", "007": "James Bond", "skyfall": "Skyfall",
            "no time to die": "Mourir Peut Attendre", "spectre": "Spectre",
            
            // Marvel / DC
            "avengers": "Avengers", "iron man": "Iron Man", "thor": "Thor",
            "captain america": "Captain America", "black panther": "Black Panther",
            "spider-man": "Spider-Man", "spiderman": "Spider-Man",
            "guardians": "Les Gardiens de la Galaxie",
            "batman": "Batman", "dark knight": "The Dark Knight",
            "superman": "Superman", "wonder woman": "Wonder Woman",
            
            // Pixar
            "toy story": "Toy Story", "you've got a friend": "Toy Story",
            "incredibles": "Les Indestructibles",
            "finding nemo": "Le Monde de Nemo", "nemo": "Le Monde de Nemo",
            "up": "L√†-Haut", "married life": "L√†-Haut",
            "inside out": "Vice-Versa",
            "soul": "Soul",
            
            // Ghibli
            "totoro": "Mon Voisin Totoro",
            "spirited away": "Le Voyage de Chihiro", "chihiro": "Le Voyage de Chihiro",
            "howl": "Le Ch√¢teau Ambulant", "merry-go-round": "Le Ch√¢teau Ambulant",
            "ponyo": "Ponyo",
            
            // Hans Zimmer
            "inception": "Inception", "interstellar": "Interstellar",
            "gladiator": "Gladiator", "now we are free": "Gladiator",
            "dune": "Dune", "dunkirk": "Dunkerque",
            
            // Autres c√©l√®bres
            "pirates caribbean": "Pirates des Cara√Øbes", "he's a pirate": "Pirates des Cara√Øbes",
            "jurassic": "Jurassic Park",
            "indiana jones": "Indiana Jones", "raiders": "Indiana Jones",
            "lord of the rings": "Le Seigneur des Anneaux", "hobbit": "Le Hobbit",
            "matrix": "Matrix",
            "rocky": "Rocky", "eye of the tiger": "Rocky", "gonna fly": "Rocky",
            "ghostbusters": "S.O.S Fant√¥mes",
            "back to future": "Retour vers le Futur",
            "top gun": "Top Gun", "danger zone": "Top Gun",
            "mission impossible": "Mission Impossible",
            "bodyguard": "Bodyguard", "i will always": "Bodyguard",
            "bohemian": "Bohemian Rhapsody",
            "shallow": "A Star Is Born",
            "greatest showman": "The Greatest Showman",
            "la la land": "La La Land",
            "moulin rouge": "Moulin Rouge",
            "chicago": "Chicago",
            "grease": "Grease",
            "dirty dancing": "Dirty Dancing",
            "footloose": "Footloose",
            "flashdance": "Flashdance",
            "breakfast club": "Breakfast Club",
            "twilight": "Twilight",
            "hunger games": "Hunger Games",
            "divergent": "Divergente"
        };

        function detectMovie(title, artist) {
            const searchText = `${title} ${artist}`.toLowerCase();
            
            for (const [keyword, movie] of Object.entries(FILM_KEYWORDS)) {
                if (searchText.includes(keyword.toLowerCase())) {
                    return { movie, keyword };
                }
            }
            return null;
        }

        function analyzeMoviePlaylist(tracks) {
            console.log('üé¨ Analyse de', tracks.length, 'morceaux...');
            
            const results = tracks.map(track => {
                const detection = detectMovie(track.title, track.artist);
                
                if (detection) {
                    console.log(`  ‚úÖ "${track.title}" ‚Üí ${detection.movie}`);
                    return {
                        ...track,
                        movieTitle: detection.movie,
                        isMovie: true,
                        keyword: detection.keyword
                    };
                } else {
                    console.log(`  ‚ùå "${track.title}" ‚Üí PAS D√âTECT√â`);
                    return {
                        ...track,
                        movieTitle: track.title,
                        isMovie: false
                    };
                }
            });
            
            const detected = results.filter(r => r.isMovie).length;
            console.log(`üé¨ ${detected} films d√©tect√©s sur ${tracks.length}`);
            
            return results.filter(r => r.isMovie);
        }

        // ===========================================
        // DEEZER API
        // ===========================================
        class DeezerAPI {
            constructor() {
                this.proxies = ['', 'https://corsproxy.io/?', 'https://api.codetabs.com/v1/proxy?quest='];
            }

            async fetchWithProxy(url) {
                for (let i = 0; i < this.proxies.length; i++) {
                    try {
                        const proxy = this.proxies[i];
                        const finalUrl = proxy + encodeURIComponent(url);
                        const response = await fetch(finalUrl);
                        if (!response.ok) throw new Error(`HTTP ${response.status}`);
                        return await response.json();
                    } catch (error) {
                        if (i === this.proxies.length - 1) throw error;
                    }
                }
            }

            async getPlaylistTracks(playlistId) {
                const url = `https://api.deezer.com/playlist/${playlistId}`;
                const data = await this.fetchWithProxy(url);
                return data.tracks.data.map(track => ({
                    id: track.id,
                    title: track.title,
                    artist: track.artist.name,
                    cover: track.album.cover_big || track.album.cover_medium,
                    preview: track.preview
                }));
            }
        }

        // ===========================================
        // UTILITAIRES
        // ===========================================
        const shuffle = arr => [...arr].sort(() => Math.random() - 0.5);
        const genCode = () => Math.random().toString(36).substring(2, 8).toUpperCase();
        
        const storage = {
            get: key => {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } catch { return null; }
            },
            set: (key, value) => {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                    return true;
                } catch { return false; }
            }
        };

        const prepareQuestions = (movieMusicDB, numQuestions) => {
            return shuffle(movieMusicDB).slice(0, numQuestions).map(q => ({ 
                ...q, 
                type: 'cinema'
            }));
        };

        // ===========================================
        // COMPOSANTS UI
        // ===========================================
        const Button = ({ children, onClick, disabled, variant = 'primary', large, className = '' }) => (
            <button 
                className={`btn ${variant} ${large ? 'large' : ''} ${className}`}
                onClick={onClick}
                disabled={disabled}
            >
                {children}
            </button>
        );

        // ===========================================
        // √âCRAN HOME (pour l'h√¥te seulement)
        // ===========================================
        const HomeScreen = ({ onCreateRoom, movieMusicDB }) => {
            const [name, setName] = useState('');
            const [playlistUrl, setPlaylistUrl] = useState('');
            const [loading, setLoading] = useState(false);
            const [numQuestions, setNumQuestions] = useState(10);
            const [deezer] = useState(new DeezerAPI());

            const handleLoadPlaylist = async () => {
                const match = playlistUrl.match(/playlist\/(\d+)/);
                if (!match) {
                    alert('‚ùå URL invalide !');
                    return;
                }
                
                setLoading(true);
                try {
                    const tracks = await deezer.getPlaylistTracks(match[1]);
                    const movies = analyzeMoviePlaylist(tracks);
                    
                    if (movies.length === 0) {
                        alert('‚ùå Aucune musique de film d√©tect√©e !');
                    } else {
                        alert(`‚úÖ ${movies.length} films d√©tect√©s !`);
                        onCreateRoom(name, numQuestions, movies);
                    }
                } catch (error) {
                    alert(`‚ùå Erreur : ${error.message}`);
                }
                setLoading(false);
            };

            return (
                <div className="screen">
                    <div className="logo">
                        <h1 className="title">QUIZ PARTY</h1>
                        <p className="subtitle">üé¨ Mode Cin√©ma üé¨</p>
                    </div>

                    <div className="host-panel">
                        <h3>üéÆ Cr√©er une partie</h3>
                        
                        <input
                            type="text"
                            className="name-input"
                            placeholder="Ton pseudo"
                            value={name}
                            onChange={(e) => setName(e.target.value)}
                            maxLength={20}
                        />

                        <div className="playlist-section">
                            <h4>üé¨ Playlist Deezer (musiques de films)</h4>
                            <input
                                type="text"
                                className="deezer-input"
                                placeholder="https://www.deezer.com/playlist/..."
                                value={playlistUrl}
                                onChange={(e) => setPlaylistUrl(e.target.value)}
                            />
                        </div>

                        <div className="num-questions-selector">
                            <label>Nombre de questions :</label>
                            <div className="num-buttons">
                                {[5, 10, 15, 20, 30].map(num => (
                                    <button
                                        key={num}
                                        className={`num-btn ${numQuestions === num ? 'active' : ''}`}
                                        onClick={() => setNumQuestions(num)}
                                    >
                                        {num}
                                    </button>
                                ))}
                            </div>
                        </div>

                        <Button 
                            large 
                            onClick={handleLoadPlaylist}
                            disabled={!name || !playlistUrl || loading}
                        >
                            {loading ? '‚è≥ Chargement...' : 'üé¨ Cr√©er la partie !'}
                        </Button>

                        {!name && <p className="warning">‚ö†Ô∏è Entre ton pseudo</p>}
                        {!playlistUrl && <p className="warning">‚ö†Ô∏è Colle une URL de playlist</p>}
                    </div>
                </div>
            );
        };

        // ===========================================
        // √âCRAN LOBBY
        // ===========================================
        const LobbyScreen = ({ room, isHost, onStart, onBackToMenu }) => {
            const inviteUrl = `${window.location.origin}${window.location.pathname}?join=${room.code}`;
            const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent(inviteUrl)}`;

            return (
                <div className="screen">
                    <h2 className="screen-title">üé¨ Salle d'attente</h2>
                    
                    <div className="qr-section">
                        <div className="code-big">{room.code}</div>
                        <h3>üì± Scanner pour rejoindre</h3>
                        <div className="qr-container">
                            <img src={qrCodeUrl} alt="QR Code" className="qr-code" />
                        </div>
                        <div className="invite-link">
                            <input 
                                type="text" 
                                value={inviteUrl} 
                                readOnly 
                                className="link-input"
                                onClick={(e) => {
                                    e.target.select();
                                    navigator.clipboard.writeText(inviteUrl);
                                    alert('‚úÖ Lien copi√© !');
                                }}
                            />
                            <button 
                                className="copy-btn"
                                onClick={() => {
                                    navigator.clipboard.writeText(inviteUrl);
                                    alert('‚úÖ Lien copi√© !');
                                }}
                            >
                                üìã
                            </button>
                        </div>
                    </div>

                    <div className="players-box">
                        <h3>üë• Joueurs ({room.players.length})</h3>
                        {room.players.map((p, i) => (
                            <div key={i} className="player">
                                <span className="player-num">{i + 1}</span>
                                <span className="player-name">{p.name}</span>
                                {p.name === room.host && <span>üëë</span>}
                            </div>
                        ))}
                    </div>

                    {isHost ? (
                        <div className="host-controls">
                            <Button large onClick={onStart}>‚ñ∂Ô∏è Lancer la partie</Button>
                            <Button variant="secondary" onClick={onBackToMenu}>
                                üîÑ Changer de playlist
                            </Button>
                        </div>
                    ) : (
                        <div className="waiting">
                            <div className="spinner"></div>
                            <p>En attente de l'h√¥te...</p>
                        </div>
                    )}
                </div>
            );
        };

        // ===========================================
        // √âCRAN GAME
        // ===========================================
        const GameScreen = ({ room, playerIndex, onAnswer }) => {
            const [time, setTime] = useState(20);
            const [answered, setAnswered] = useState(false);
            const [input, setInput] = useState('');
            const [result, setResult] = useState(null);

            const audioRef = useRef(null);
            const timerRef = useRef(null);
            const autoSubmitRef = useRef(false);
            
            const q = room.questions[room.currentQ];
            const player = room.players[playerIndex];

            const blurAmount = answered ? 0 : Math.max(0, (time / 20) * 25);

            useEffect(() => {
                setTime(20);
                setAnswered(false);
                setResult(null);
                setInput('');
                autoSubmitRef.current = false;

                if (audioRef.current) {
                    audioRef.current.pause();
                    audioRef.current.currentTime = 0;
                }
                setTimeout(() => audioRef.current?.play().catch(() => {}), 200);

                timerRef.current = setInterval(() => {
                    setTime(prev => {
                        if (prev <= 1) {
                            clearInterval(timerRef.current);
                            if (!autoSubmitRef.current) {
                                autoSubmitRef.current = true;
                                submit(0);
                            }
                            return 0;
                        }
                        return prev - 1;
                    });
                }, 1000);

                return () => {
                    clearInterval(timerRef.current);
                    if (audioRef.current) audioRef.current.pause();
                };
            }, [room.currentQ]);

            const submit = (timeWhenAnswered = time) => {
                if (answered) return;
                setAnswered(true);
                clearInterval(timerRef.current);
                if (audioRef.current) audioRef.current.pause();

                const userInput = input.toLowerCase().trim();
                const movieTitle = q.movieTitle.toLowerCase();
                
                const correct = userInput && (
                    movieTitle.includes(userInput) || 
                    userInput.includes(movieTitle.split(' ')[0])
                );
                
                const points = correct ? (50 + timeWhenAnswered * 10) : 0;
                const msg = correct ? `üéâ Bravo ! +${points} pts` : `‚ùå C'√©tait : ${q.movieTitle}`;

                setResult({ correct, msg });

                setTimeout(() => {
                    onAnswer(points);
                }, 2500);
            };

            return (
                <div className="screen game">
                    <div className="game-header">
                        <div className="timer">‚è±Ô∏è {time}s</div>
                        <div>Q {room.currentQ + 1}/{room.questions.length}</div>
                        <div className="score">üèÜ {player.score}</div>
                    </div>

                    <div className="img-box">
                        <img 
                            src={q.cover} 
                            alt="Cover" 
                            className="cover" 
                            style={{ filter: `blur(${blurAmount}px)` }}
                        />
                    </div>

                    <div className="audio-box">
                        <audio ref={audioRef} src={q.preview} loop />
                        <button className="audio-btn" onClick={() => {
                            if (audioRef.current?.paused) audioRef.current.play();
                            else audioRef.current?.pause();
                        }}>
                            üéµ {answered ? 'Arr√™ter' : '√âcouter'}
                        </button>
                    </div>

                    <div className="question-box">
                        <h3 className="q-text">üé¨ De quel film vient cette musique ?</h3>
                        <input
                            className="input"
                            placeholder="Titre du film..."
                            value={input}
                            onChange={(e) => setInput(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && !answered && submit(time)}
                            disabled={answered}
                            autoFocus
                        />
                        {!answered && <Button onClick={() => submit(time)}>Valider</Button>}

                        {result && (
                            <div className={`result ${result.correct ? 'correct' : 'wrong'}`}>
                                {result.msg}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // ===========================================
        // √âCRAN LEADERBOARD
        // ===========================================
        const LeaderboardScreen = ({ room, onRestart, isHost }) => {
            if (!room || !room.players) {
                return <div className="screen"><h2>Chargement...</h2></div>;
            }

            const sorted = [...room.players].sort((a, b) => b.score - a.score);

            return (
                <div className="screen">
                    <h2 className="screen-title">üèÜ Classement Final üèÜ</h2>
                    
                    <div className="podium">
                        {sorted.slice(0, 3).map((p, i) => (
                            <div key={i} className={`podium-item p${i+1}`}>
                                <div className="medal">{['ü•á','ü•à','ü•â'][i]}</div>
                                <div className="p-name">{p.name}</div>
                                <div className="p-score">{p.score} pts</div>
                            </div>
                        ))}
                    </div>

                    <div className="leaderboard">
                        {sorted.map((p, i) => (
                            <div key={i} className="lb-row">
                                <span className="rank">#{i+1}</span>
                                <span className="name">{p.name}</span>
                                <span className="pts">{p.score} pts</span>
                            </div>
                        ))}
                    </div>

                    {isHost && (
                        <Button large onClick={onRestart}>üè† Nouvelle partie</Button>
                    )}
                    
                    {!isHost && (
                        <div className="waiting">
                            <div className="spinner"></div>
                            <p>En attente de l'h√¥te...</p>
                        </div>
                    )}
                </div>
            );
        };

        // ===========================================
        // APP PRINCIPALE
        // ===========================================
        const App = () => {
            const [screen, setScreen] = useState('loading');
            const [playerName, setPlayerName] = useState('');
            const [room, setRoom] = useState(null);
            const [playerIdx, setPlayerIdx] = useState(0);
            const [isHost, setIsHost] = useState(false);
            const [movieMusicDB, setMovieMusicDB] = useState([]);

            const pollRef = useRef(null);

            // V√©rifier si on rejoint via QR Code
            useEffect(() => {
                const urlParams = new URLSearchParams(window.location.search);
                const joinCode = urlParams.get('join');
                
                if (joinCode) {
                    const name = prompt('üé¨ Entre ton pseudo pour rejoindre :');
                    if (name && name.trim()) {
                        const existing = storage.get(`room:${joinCode}`);
                        if (existing && !existing.started) {
                            setPlayerName(name.trim());
                            existing.players.push({ name: name.trim(), score: 0 });
                            storage.set(`room:${joinCode}`, existing);
                            setRoom(existing);
                            setPlayerIdx(existing.players.length - 1);
                            setIsHost(false);
                            setScreen('lobby');
                            window.history.replaceState({}, '', window.location.pathname);
                        } else {
                            alert('‚ùå Code invalide ou partie d√©j√† lanc√©e !');
                            window.location.href = window.location.pathname;
                        }
                    } else {
                        window.location.href = window.location.pathname;
                    }
                } else {
                    setScreen('home');
                }
            }, []);

            useEffect(() => {
                if (room?.code && screen !== 'leaderboard') {
                    pollRef.current = setInterval(() => {
                        const latest = storage.get(`room:${room.code}`);
                        if (latest) {
                            setRoom(latest);
                            if (latest.started && screen === 'lobby') {
                                setScreen('game');
                            }
                            if (latest.currentQ >= latest.questions.length && screen === 'game') {
                                clearInterval(pollRef.current);
                                setTimeout(() => setScreen('leaderboard'), 1000);
                            }
                            if (latest.resetToLobby && !isHost) {
                                setScreen('lobby');
                                const updated = { ...latest, resetToLobby: false };
                                storage.set(`room:${room.code}`, updated);
                            }
                        }
                    }, 1000);
                }
                return () => clearInterval(pollRef.current);
            }, [room?.code, screen]);

            const createRoom = (name, numQuestions, movies) => {
                const code = genCode();
                setPlayerName(name);
                setMovieMusicDB(movies);

                const newRoom = {
                    code,
                    host: name,
                    players: [{ name, score: 0 }],
                    questions: prepareQuestions(movies, numQuestions),
                    currentQ: 0,
                    started: false,
                    movies: movies
                };
                
                storage.set(`room:${code}`, newRoom);
                setRoom(newRoom);
                setPlayerIdx(0);
                setIsHost(true);
                setScreen('lobby');
            };

            const startGame = () => {
                const updated = { ...room, started: true };
                storage.set(`room:${room.code}`, updated);
                setRoom(updated);
                setScreen('game');
            };

            const backToMenu = () => {
                const updated = { 
                    ...room, 
                    started: false,
                    resetToLobby: true
                };
                storage.set(`room:${room.code}`, updated);
                setScreen('home');
            };

            const handleAnswer = (points) => {
                const updated = { ...room };
                updated.players[playerIdx].score += points;
                updated.currentQ += 1;
                
                storage.set(`room:${room.code}`, updated);
                setRoom(updated);

                if (updated.currentQ >= updated.questions.length) {
                    setTimeout(() => setScreen('leaderboard'), 1000);
                }
            };

            const restart = () => {
                if (pollRef.current) clearInterval(pollRef.current);
                setScreen('home');
                setRoom(null);
                setPlayerName('');
            };

            if (screen === 'loading') {
                return (
                    <div className="app">
                        <div className="bg"></div>
                        <div className="screen">
                            <div className="spinner"></div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="app">
                    <div className="bg"></div>
                    {screen === 'home' && (
                        <HomeScreen 
                            onCreateRoom={createRoom}
                            movieMusicDB={movieMusicDB}
                        />
                    )}
                    {screen === 'lobby' && room && (
                        <LobbyScreen 
                            room={room}
                            isHost={isHost}
                            onStart={startGame}
                            onBackToMenu={backToMenu}
                        />
                    )}
                    {screen === 'game' && room && (
                        <GameScreen 
                            room={room}
                            playerIndex={playerIdx}
                            onAnswer={handleAnswer}
                        />
                    )}
                    {screen === 'leaderboard' && room && (
                        <LeaderboardScreen 
                            room={room}
                            onRestart={restart}
                            isHost={isHost}
                        />
                    )}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background: #0a0e27;
            color: white;
            overflow-x: hidden;
        }

        .app {
            min-height: 100vh;
            position: relative;
        }

        .bg {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255, 0, 110, 0.1), transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(131, 56, 236, 0.1), transparent 50%);
            animation: pulse 8s infinite;
            z-index: 0;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.8; }
        }

        .screen {
            position: relative;
            z-index: 1;
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .screen.game {
            justify-content: flex-start;
            padding-top: 1rem;
        }

        .logo {
            text-align: center;
            margin-bottom: 2rem;
        }

        .title {
            font-family: 'Bungee Shade', cursive;
            font-size: 4rem;
            background: linear-gradient(45deg, #ff006e, #00f5ff, #ffbe0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            font-size: 1.5rem;
            color: #00f5ff;
            letter-spacing: 0.2em;
            margin-top: 0.5rem;
        }

        .host-panel {
            background: #1a1f3a;
            border: 3px solid #8338ec;
            border-radius: 25px;
            padding: 3rem;
            width: 100%;
            max-width: 600px;
            text-align: center;
        }

        .host-panel h3 {
            color: #ffbe0b;
            font-size: 1.8rem;
            margin-bottom: 2rem;
        }

        .host-panel h4 {
            color: #ff006e;
            margin: 1.5rem 0 0.5rem;
        }

        .name-input, .deezer-input {
            width: 100%;
            padding: 1.2rem;
            margin: 1rem 0;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #8338ec;
            border-radius: 15px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            text-align: center;
            font-family: 'Montserrat', sans-serif;
        }

        .name-input:focus, .deezer-input:focus {
            outline: none;
            border-color: #ff006e;
        }

        .playlist-section {
            margin: 2rem 0;
        }

        .num-questions-selector {
            margin: 2rem 0;
        }

        .num-questions-selector label {
            display: block;
            color: #00f5ff;
            font-size: 1.1rem;
            font-weight: 800;
            margin-bottom: 1rem;
        }

        .num-buttons {
            display: flex;
            gap: 0.8rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .num-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid #8338ec;
            color: white;
            padding: 0.8rem 1.3rem;
            font-size: 1.1rem;
            font-weight: 800;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Montserrat', sans-serif;
        }

        .num-btn:hover {
            background: rgba(131, 56, 236, 0.2);
            transform: scale(1.05);
        }

        .num-btn.active {
            background: linear-gradient(135deg, #ff006e, #8338ec);
            border-color: #ff006e;
        }

        .warning {
            color: #ff006e;
            font-weight: 600;
            margin-top: 1rem;
        }

        .btn {
            background: linear-gradient(135deg, #ff006e, #8338ec);
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: 800;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Montserrat', sans-serif;
            margin: 0.5rem;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 0, 110, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn.secondary {
            background: linear-gradient(135deg, #ffbe0b, #00f5ff);
        }

        .btn.large {
            padding: 1.5rem 3rem;
            font-size: 1.3rem;
            margin-top: 1rem;
        }

        .screen-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: #ffbe0b;
            margin-bottom: 2rem;
            text-align: center;
        }

        .code-big {
            font-size: 4rem;
            font-weight: 800;
            color: #ffbe0b;
            letter-spacing: 0.3em;
            text-align: center;
            margin-bottom: 1rem;
            text-shadow: 0 0 20px rgba(255, 190, 11, 0.5);
        }

        .qr-section {
            background: #1a1f3a;
            border: 3px solid #00f5ff;
            border-radius: 25px;
            padding: 2rem;
            margin-bottom: 2rem;
            width: 100%;
            max-width: 500px;
            text-align: center;
        }

        .qr-section h3 {
            color: #00f5ff;
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
        }

        .qr-container {
            background: white;
            padding: 1rem;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 1.5rem;
            box-shadow: 0 10px 40px rgba(0, 245, 255, 0.3);
        }

        .qr-code {
            width: 250px;
            height: 250px;
            display: block;
        }

        .invite-link {
            display: flex;
            gap: 0.5rem;
        }

        .link-input {
            flex: 1;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #8338ec;
            border-radius: 12px;
            color: white;
            font-size: 0.85rem;
            font-family: 'Montserrat', sans-serif;
            cursor: pointer;
        }

        .copy-btn {
            background: linear-gradient(135deg, #00f5ff, #8338ec);
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            font-size: 1.2rem;
            border-radius: 12px;
            cursor: pointer;
        }

        .players-box {
            background: #1a1f3a;
            border: 2px solid #8338ec;
            border-radius: 20px;
            padding: 2rem;
            width: 100%;
            max-width: 600px;
            margin-bottom: 2rem;
        }

        .players-box h3 {
            color: #00f5ff;
            margin-bottom: 1rem;
        }

        .player {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .player-num {
            background: #8338ec;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
        }

        .player-name {
            flex: 1;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .host-controls {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            align-items: center;
        }

        .waiting {
            text-align: center;
            margin-top: 2rem;
        }

        .waiting p {
            font-size: 1.2rem;
            color: #ffbe0b;
            margin-top: 1rem;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-top-color: #ff006e;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 800px;
            margin-bottom: 1.5rem;
            background: #1a1f3a;
            padding: 1rem 1.5rem;
            border-radius: 15px;
            border: 2px solid #8338ec;
            font-weight: 800;
            font-size: 1.2rem;
        }

        .timer {
            color: #ff006e;
        }

        .score {
            color: #ffbe0b;
        }

        .img-box {
            width: 100%;
            max-width: 450px;
            margin: 0 auto 1.5rem;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .cover {
            width: 100%;
            height: 450px;
            object-fit: cover;
            transition: filter 0.3s ease;
        }

        .audio-box {
            text-align: center;
            margin: 1.5rem 0;
        }

        .audio-btn {
            background: linear-gradient(135deg, #ffbe0b, #ff006e);
            color: white;
            border: none;
            padding: 1rem 2.5rem;
            font-size: 1.1rem;
            font-weight: 800;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            box-shadow: 0 5px 20px rgba(255, 190, 11, 0.4);
        }

        .question-box {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }

        .q-text {
            text-align: center;
            font-size: 1.8rem;
            font-weight: 800;
            color: #00f5ff;
            margin-bottom: 1.5rem;
        }

        .input {
            width: 100%;
            padding: 1.2rem;
            margin-bottom: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #8338ec;
            border-radius: 15px;
            color: white;
            font-size: 1.2rem;
            text-align: center;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
        }

        .input:focus {
            outline: none;
            border-color: #ff006e;
        }

        .result {
            margin-top: 1.5rem;
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            font-size: 1.4rem;
            font-weight: 800;
        }

        .result.correct {
            background: rgba(0, 255, 100, 0.2);
            border: 2px solid #00ff64;
            color: #00ff64;
        }

        .result.wrong {
            background: rgba(255, 0, 0, 0.2);
            border: 2px solid #ff0033;
            color: #ff6b6b;
        }

        .podium {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .podium-item {
            background: #1a1f3a;
            border: 3px solid #8338ec;
            border-radius: 20px;
            padding: 2rem 1.5rem;
            text-align: center;
            min-width: 150px;
        }

        .podium-item.p1 {
            border-color: #FFD700;
            transform: scale(1.15);
        }

        .podium-item.p2 {
            border-color: #C0C0C0;
        }

        .podium-item.p3 {
            border-color: #CD7F32;
        }

        .medal {
            font-size: 3.5rem;
            margin-bottom: 0.5rem;
        }

        .p-name {
            font-weight: 800;
            font-size: 1.2rem;
            color: #ffbe0b;
            margin-bottom: 0.5rem;
        }

        .p-score {
            font-size: 1.6rem;
            font-weight: 800;
            color: #ff006e;
        }

        .leaderboard {
            background: #1a1f3a;
            border: 2px solid #8338ec;
            border-radius: 20px;
            padding: 1.5rem;
            width: 100%;
            max-width: 600px;
            margin: 2rem 0;
        }

        .lb-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-bottom: 0.5rem;
        }

        .rank {
            background: #8338ec;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
        }

        .name {
            flex: 1;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .pts {
            font-weight: 800;
            color: #ffbe0b;
            font-size: 1.3rem;
        }

        @media (max-width: 768px) {
            .title { font-size: 2.5rem; }
            .host-panel { padding: 2rem 1.5rem; }
            .code-big { font-size: 3rem; }
            .qr-code { width: 200px; height: 200px; }
            .cover { height: 350px; }
        }
    </style>
</body>
</html>
