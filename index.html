<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Party üéµ Deezer Edition</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <link href="https://fonts.googleapis.com/css2?family=Bungee+Shade&family=Montserrat:wght@600;800&display=swap" rel="stylesheet">
</head>
<body>
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ===========================================
        // GEMINI AI pour d√©tection automatique des films
        // ===========================================
        const GEMINI_API_KEY = 'AIzaSyD0qW3cCIMLx2QPhf9hvrycYGiFGiiCcb4'; // Cl√© API Gemini activ√©e !
        
        class GeminiFilmDetector {
            constructor(apiKey) {
                this.apiKey = apiKey;
                this.cache = {}; // Cache pour √©viter de rappeler l'API
            }

            async detectMoviesFromTracks(tracks) {
                if (!this.apiKey || this.apiKey === 'METTRE_TA_CLE_API_ICI') {
                    console.warn('‚ö†Ô∏è Pas de cl√© API Gemini, utilisation du mapping manuel');
                    return tracks.map(track => ({
                        ...track,
                        movieTitle: getMovieFromMusic(track.title, track.artist)
                    }));
                }

                console.log('ü§ñ Demande √† Gemini de d√©tecter les films...');
                
                // Pr√©parer les morceaux pour Gemini (par lots de 10)
                const results = [];
                
                for (let i = 0; i < tracks.length; i += 10) {
                    const batch = tracks.slice(i, i + 10);
                    const tracksList = batch.map((t, idx) => 
                        `${i + idx + 1}. "${t.title}" par ${t.artist}`
                    ).join('\n');

                    const prompt = `Tu es un expert en musiques de films. Pour chaque morceau ci-dessous, identifie de quel film il provient.
Si c'est une musique de film, r√©ponds UNIQUEMENT avec le titre du film en fran√ßais.
Si ce n'est PAS une musique de film, r√©ponds "NON".
Format de r√©ponse : un film par ligne, dans l'ordre des morceaux.

Morceaux :
${tracksList}

R√©ponds uniquement avec les titres de films (ou "NON"), un par ligne, sans num√©rotation ni explication.`;

                    try {
                        const response = await fetch(
                            `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${this.apiKey}`,
                            {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    contents: [{
                                        parts: [{ text: prompt }]
                                    }]
                                })
                            }
                        );

                        const data = await response.json();
                        const text = data.candidates[0].content.parts[0].text;
                        const movies = text.trim().split('\n').map(line => line.trim());

                        console.log(`‚úÖ Gemini a analys√© ${batch.length} morceaux`);

                        // Associer les r√©sultats
                        batch.forEach((track, idx) => {
                            const detectedMovie = movies[idx];
                            const movieTitle = (detectedMovie && detectedMovie !== 'NON') 
                                ? detectedMovie 
                                : getMovieFromMusic(track.title, track.artist);
                            
                            results.push({
                                ...track,
                                movieTitle: movieTitle,
                                detectedByAI: detectedMovie && detectedMovie !== 'NON'
                            });
                        });

                        // Attendre 1 seconde entre les lots pour ne pas surcharger l'API
                        if (i + 10 < tracks.length) {
                            await new Promise(resolve => setTimeout(resolve, 1000));
                        }

                    } catch (error) {
                        console.error('‚ùå Erreur Gemini:', error);
                        // Fallback sur le mapping manuel
                        batch.forEach(track => {
                            results.push({
                                ...track,
                                movieTitle: getMovieFromMusic(track.title, track.artist),
                                detectedByAI: false
                            });
                        });
                    }
                }

                const aiDetected = results.filter(r => r.detectedByAI).length;
                console.log(`üé¨ R√©sultat : ${aiDetected} films d√©tect√©s par IA, ${results.length - aiDetected} par mapping manuel`);

                return results;
            }
        }

        // ===========================================
        // MAPPING MUSIQUES ‚Üí FILMS (Fallback si pas d'API)
        // ===========================================
        // Format: "Titre musique (Artiste)" : "Titre du film"
        const MOVIE_MUSIC_MAP = {
            // Harry Potter - Tous les th√®mes
            "lily": "Harry Potter",
            "harry potter": "Harry Potter",
            "hedwig": "Harry Potter",
            "hogwarts": "Harry Potter",
            "potter": "Harry Potter",
            "obliviate": "Harry Potter",
            "dumbledore": "Harry Potter",
            
            // Star Wars
            "star wars": "Star Wars",
            "imperial": "Star Wars",
            "force theme": "Star Wars",
            "duel of the fates": "Star Wars",
            
            // Titanic / Celine Dion
            "my heart will go on": "Titanic",
            "titanic": "Titanic",
            "celine dion titanic": "Titanic",
            
            // James Bond
            "skyfall": "Skyfall",
            "james bond": "James Bond",
            "007": "James Bond",
            
            // Disney
            "let it go": "La Reine des Neiges",
            "frozen": "La Reine des Neiges",
            "circle of life": "Le Roi Lion",
            "lion king": "Le Roi Lion",
            "whole new world": "Aladdin",
            "aladdin": "Aladdin",
            
            // Films musicaux
            "shallow": "A Star Is Born",
            "bohemian rhapsody": "Bohemian Rhapsody",
            "eye of the tiger": "Rocky",
            "rocky": "Rocky",
            "lose yourself": "8 Mile",
            "purple rain": "Purple Rain",
            "footloose": "Footloose",
            "flashdance": "Flashdance",
            "dirty dancing": "Dirty Dancing",
            "top gun": "Top Gun",
            "danger zone": "Top Gun",
            "ghostbusters": "S.O.S Fant√¥mes",
            "back to the future": "Retour vers le Futur",
            "power of love": "Retour vers le Futur",
            "bodyguard": "Bodyguard",
            "i will always love you": "Bodyguard",
            
            // Aventure
            "jurassic": "Jurassic Park",
            "pirates": "Pirates des Cara√Øbes",
            "indiana jones": "Indiana Jones",
            
            // Marvel / DC
            "avengers": "Avengers",
            "iron man": "Iron Man",
            "batman": "Batman",
            "dark knight": "The Dark Knight",
            "superman": "Superman",
            
            // Hans Zimmer
            "interstellar": "Interstellar",
            "inception": "Inception",
            "time hans": "Inception",
            "gladiator": "Gladiator",
            "now we are free": "Gladiator",
            
            // Fantasy
            "lord of the rings": "Le Seigneur des Anneaux",
            "hobbit": "Le Hobbit",
            "concerning hobbits": "Le Seigneur des Anneaux"
        };

        // ===========================================
        // DEEZER API
        // ===========================================
        class DeezerAPI {
            constructor() {
                this.proxies = [
                    '',
                    'https://corsproxy.io/?',
                    'https://api.codetabs.com/v1/proxy?quest='
                ];
            }

            async fetchWithProxy(url) {
                for (let i = 0; i < this.proxies.length; i++) {
                    try {
                        const proxy = this.proxies[i];
                        const finalUrl = proxy + encodeURIComponent(url);
                        console.log(`üîÑ Tentative ${i + 1}/${this.proxies.length}`);
                        
                        const response = await fetch(finalUrl);
                        if (!response.ok) throw new Error(`HTTP ${response.status}`);
                        
                        const data = await response.json();
                        console.log('‚úÖ Succ√®s !');
                        return data;
                    } catch (error) {
                        console.warn(`‚ùå Proxy ${i + 1} √©chou√©`);
                        if (i === this.proxies.length - 1) {
                            throw new Error('Tous les proxies ont √©chou√©');
                        }
                    }
                }
            }

            async searchTracks(query, limit = 50) {
                try {
                    const url = `https://api.deezer.com/search?q=${encodeURIComponent(query)}&limit=${limit}`;
                    const data = await this.fetchWithProxy(url);
                    
                    if (!data.data || data.data.length === 0) {
                        throw new Error('Aucun r√©sultat');
                    }
                    
                    return data.data.map(track => ({
                        id: track.id,
                        title: track.title,
                        artist: track.artist.name,
                        cover: track.album.cover_big || track.album.cover_medium,
                        preview: track.preview
                    }));
                } catch (error) {
                    console.error('Deezer search error:', error);
                    throw error;
                }
            }

            async getPlaylistTracks(playlistId) {
                try {
                    const url = `https://api.deezer.com/playlist/${playlistId}`;
                    const data = await this.fetchWithProxy(url);
                    
                    if (!data.tracks || !data.tracks.data) {
                        throw new Error('Playlist introuvable');
                    }
                    
                    return data.tracks.data.map(track => ({
                        id: track.id,
                        title: track.title,
                        artist: track.artist.name,
                        cover: track.album.cover_big || track.album.cover_medium,
                        preview: track.preview
                    }));
                } catch (error) {
                    console.error('Deezer playlist error:', error);
                    throw error;
                }
            }

            async getChart(limit = 50) {
                try {
                    const url = `https://api.deezer.com/chart/0/tracks?limit=${limit}`;
                    const data = await this.fetchWithProxy(url);
                    
                    if (!data.data || data.data.length === 0) {
                        throw new Error('Chart introuvable');
                    }
                    
                    return data.data.map(track => ({
                        id: track.id,
                        title: track.title,
                        artist: track.artist.name,
                        cover: track.album.cover_big,
                        preview: track.preview
                    }));
                } catch (error) {
                    console.error('Deezer chart error:', error);
                    throw error;
                }
            }
        }

        // ===========================================
        // UTILITAIRES
        // ===========================================
        const shuffle = arr => [...arr].sort(() => Math.random() - 0.5);
        const genCode = () => Math.random().toString(36).substring(2, 8).toUpperCase();
        
        const storage = {
            get: key => {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } catch { return null; }
            },
            set: (key, value) => {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                    return true;
                } catch { return false; }
            }
        };

        // Fonction pour trouver le film correspondant √† une musique
        const getMovieFromMusic = (musicTitle, artistName) => {
            const searchText = `${musicTitle} ${artistName}`.toLowerCase();
            
            // Chercher dans le mapping (insensible √† la casse)
            for (const [keyword, movie] of Object.entries(MOVIE_MUSIC_MAP)) {
                if (searchText.includes(keyword.toLowerCase())) {
                    console.log(`‚úÖ Film d√©tect√©: "${keyword}" ‚Üí ${movie}`);
                    return movie;
                }
            }
            
            console.log(`‚ùå Aucun film d√©tect√© pour: ${musicTitle} - ${artistName}`);
            return musicTitle; // Retourne le titre de la musique par d√©faut
        };

        const prepareQuestions = (mode, musicDB, numQuestions, movieMusicDB = []) => {
            const music = shuffle(musicDB);

            if (mode === 'soiree') {
                const questionsPerType = Math.floor(numQuestions / 2);
                return [
                    ...music.slice(0, questionsPerType).map(q => ({ ...q, type: 'qcm' })),
                    ...music.slice(questionsPerType, numQuestions).map(q => ({ ...q, type: 'writing' }))
                ];
            }
            if (mode === 'cinema') {
                // Mode cin√©ma avec les musiques de films
                return shuffle(movieMusicDB).slice(0, numQuestions).map(q => ({ 
                    ...q, 
                    type: 'cinema',
                    movieTitle: q.movieTitle || getMovieFromMusic(q.title, q.artist) || q.title
                }));
            }
            return music.slice(0, numQuestions).map(q => ({ ...q, type: mode }));
        };

        // ===========================================
        // COMPOSANTS UI
        // ===========================================
        const Button = ({ children, onClick, disabled, variant = 'primary', large, className = '' }) => (
            <button 
                className={`btn ${variant} ${large ? 'large' : ''} ${className}`}
                onClick={onClick}
                disabled={disabled}
            >
                {children}
            </button>
        );

        const ModeCard = ({ icon, title, desc, onClick, special }) => (
            <div className={`mode-card ${special ? 'special' : ''}`} onClick={onClick}>
                <div className="mode-icon">{icon}</div>
                <div className="mode-title">{title}</div>
                <div className="mode-desc">{desc}</div>
            </div>
        );

        // ===========================================
        // √âCRAN HOME
        // ===========================================
        const HomeScreen = ({ onStart, onLoadDeezerData, onLoadMovieMusic }) => {
            const [name, setName] = useState('');
            const [searchQuery, setSearchQuery] = useState('');
            const [playlistUrl, setPlaylistUrl] = useState('');
            const [moviePlaylistUrl, setMoviePlaylistUrl] = useState('');
            const [loading, setLoading] = useState(false);
            const [numQuestions, setNumQuestions] = useState(10);

            const handleSearch = async () => {
                if (!searchQuery.trim()) return;
                setLoading(true);
                await onLoadDeezerData('search', searchQuery);
                setLoading(false);
            };

            const handlePlaylist = async () => {
                const match = playlistUrl.match(/playlist\/(\d+)/);
                if (!match) {
                    alert('‚ùå URL invalide ! Exemple: https://www.deezer.com/fr/playlist/1234567890');
                    return;
                }
                setLoading(true);
                await onLoadDeezerData('playlist', match[1]);
                setLoading(false);
            };

            const handleMoviePlaylist = async () => {
                const match = moviePlaylistUrl.match(/playlist\/(\d+)/);
                if (!match) {
                    alert('‚ùå URL invalide ! Exemple: https://www.deezer.com/fr/playlist/1234567890');
                    return;
                }
                setLoading(true);
                await onLoadMovieMusic(match[1]);
                setLoading(false);
            };

            const handleTopChart = async () => {
                setLoading(true);
                await onLoadDeezerData('chart');
                setLoading(false);
            };

            return (
                <div className="screen">
                    <div className="logo">
                        <h1 className="title">QUIZ PARTY</h1>
                        <p className="subtitle">üéµ Musique & Cin√©ma üé¨</p>
                    </div>

                    <div className="deezer-banner">
                        <h3>üéµ Powered by Deezer</h3>
                        <p>100% des morceaux ont l'audio - Aucune connexion n√©cessaire !</p>
                        
                        {GEMINI_API_KEY === 'METTRE_TA_CLE_API_ICI' && (
                            <div className="gemini-warning">
                                <p>üí° <strong>D√©tection IA d√©sactiv√©e</strong></p>
                                <p style={{fontSize: '0.9rem', marginTop: '0.5rem'}}>
                                    Pour d√©tecter automatiquement tous les films avec l'IA Gemini :<br/>
                                    1. Va sur <a href="https://makersuite.google.com/app/apikey" target="_blank" style={{color: '#00f5ff'}}>makersuite.google.com/app/apikey</a><br/>
                                    2. Cr√©e une cl√© API gratuite<br/>
                                    3. Remplace "METTRE_TA_CLE_API_ICI" dans le code (ligne 24)
                                </p>
                            </div>
                        )}
                        
                        {GEMINI_API_KEY !== 'METTRE_TA_CLE_API_ICI' && (
                            <div className="gemini-success">
                                <p>ü§ñ <strong>D√©tection IA activ√©e !</strong></p>
                                <p style={{fontSize: '0.9rem', marginTop: '0.5rem'}}>
                                    Gemini identifiera automatiquement les films üé¨
                                </p>
                            </div>
                        )}
                        
                        <div className="deezer-options">
                            <div className="deezer-option">
                                <h4>üî• Top Chart</h4>
                                <p>Les 50 morceaux les plus √©cout√©s</p>
                                <Button onClick={handleTopChart} disabled={loading}>
                                    {loading ? '‚è≥' : 'üéµ'} Charger le Top 50
                                </Button>
                            </div>

                            <div className="deezer-option">
                                <h4>üîç Recherche</h4>
                                <input
                                    type="text"
                                    className="deezer-input"
                                    placeholder="Artiste, chanson, genre..."
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
                                />
                                <Button onClick={handleSearch} disabled={loading || !searchQuery.trim()}>
                                    {loading ? '‚è≥' : 'üîç'} Rechercher
                                </Button>
                            </div>

                            <div className="deezer-option">
                                <h4>üìã Playlist Musique</h4>
                                <input
                                    type="text"
                                    className="deezer-input"
                                    placeholder="https://www.deezer.com/playlist/..."
                                    value={playlistUrl}
                                    onChange={(e) => setPlaylistUrl(e.target.value)}
                                />
                                <Button onClick={handlePlaylist} disabled={loading || !playlistUrl.trim()}>
                                    {loading ? '‚è≥' : 'üìã'} Charger
                                </Button>
                            </div>

                            <div className="deezer-option cinema">
                                <h4>üé¨ Playlist Films (BO)</h4>
                                <p>Pour le mode Cin√©ma</p>
                                <input
                                    type="text"
                                    className="deezer-input"
                                    placeholder="Playlist Deezer de musiques de films..."
                                    value={moviePlaylistUrl}
                                    onChange={(e) => setMoviePlaylistUrl(e.target.value)}
                                />
                                <Button onClick={handleMoviePlaylist} disabled={loading || !moviePlaylistUrl.trim()}>
                                    {loading ? '‚è≥' : 'üé¨'} Charger BO
                                </Button>
                            </div>
                        </div>
                    </div>

                    <input
                        type="text"
                        className="name-input"
                        placeholder="Ton pseudo"
                        value={name}
                        onChange={(e) => setName(e.target.value)}
                        maxLength={20}
                    />

                    <div className="num-questions-selector">
                        <label>Nombre de questions :</label>
                        <div className="num-buttons">
                            {[5, 10, 15, 20, 30].map(num => (
                                <button
                                    key={num}
                                    className={`num-btn ${numQuestions === num ? 'active' : ''}`}
                                    onClick={() => setNumQuestions(num)}
                                >
                                    {num}
                                </button>
                            ))}
                        </div>
                    </div>

                    <div className="mode-grid">
                        <ModeCard icon="üéØ" title="Mode QCM" desc="Choix multiples" onClick={() => name && onStart('qcm', name, numQuestions)} />
                        <ModeCard icon="‚úçÔ∏è" title="Mode √âcriture" desc="Titre + Artiste" onClick={() => name && onStart('writing', name, numQuestions)} />
                        <ModeCard icon="üé¨" title="Mode Cin√©ma" desc="Devine le film depuis la BO !" onClick={() => name && onStart('cinema', name, numQuestions)} />
                        <ModeCard icon="üéâ" title="Mode Soir√©e" desc="QCM + √âcriture m√©lang√©s !" onClick={() => name && onStart('soiree', name, numQuestions)} special />
                    </div>

                    {!name && <p className="warning">‚ö†Ô∏è Entre ton pseudo</p>}
                </div>
            );
        };

        // ===========================================
        // √âCRAN JOIN
        // ===========================================
        const JoinScreen = ({ onCreateRoom, onJoinRoom, onBack }) => {
            const [code, setCode] = useState('');

            return (
                <div className="screen">
                    <h2 className="screen-title">Rejoindre une partie</h2>
                    
                    <div className="join-grid">
                        <div className="join-card">
                            <h3>Cr√©er une partie</h3>
                            <p>Tu seras l'h√¥te</p>
                            <Button onClick={onCreateRoom}>‚ñ∂Ô∏è Cr√©er</Button>
                        </div>

                        <div className="join-divider">OU</div>

                        <div className="join-card">
                            <h3>Rejoindre</h3>
                            <input
                                type="text"
                                className="code-input"
                                placeholder="CODE"
                                value={code}
                                onChange={(e) => setCode(e.target.value.toUpperCase())}
                                maxLength={6}
                            />
                            <Button variant="secondary" onClick={() => onJoinRoom(code)} disabled={code.length !== 6}>
                                üë• Rejoindre
                            </Button>
                        </div>
                    </div>

                    <Button onClick={onBack} className="back-btn">üè† Retour</Button>
                </div>
            );
        };

        // ===========================================
        // √âCRAN LOBBY
        // ===========================================
        const LobbyScreen = ({ room, isHost, onStart }) => (
            <div className="screen">
                <h2 className="screen-title">Salle d'attente</h2>
                
                <div className="code-display">
                    <div className="code-label">Code</div>
                    <div className="code-value">{room.code}</div>
                </div>

                <div className="players-box">
                    <h3>üë• Joueurs ({room.players.length})</h3>
                    {room.players.map((p, i) => (
                        <div key={i} className="player">
                            <span className="player-num">{i + 1}</span>
                            <span className="player-name">{p.name}</span>
                            {p.name === room.host && <span>üëë</span>}
                        </div>
                    ))}
                </div>

                {isHost ? (
                    <Button large onClick={onStart}>‚ñ∂Ô∏è Lancer</Button>
                ) : (
                    <div className="waiting">
                        <p>‚ö° En attente...</p>
                    </div>
                )}
            </div>
        );

        // ===========================================
        // √âCRAN GAME
        // ===========================================
        const GameScreen = ({ room, playerIndex, onAnswer, musicDB }) => {
            const [time, setTime] = useState(20);
            const [answered, setAnswered] = useState(false);
            const [options, setOptions] = useState([]);
            const [correctAns, setCorrectAns] = useState('');
            const [qText, setQText] = useState('');
            const [inputs, setInputs] = useState({ title: '', artist: '', movie: '' });
            const [result, setResult] = useState(null);

            const audioRef = useRef(null);
            const timerRef = useRef(null);
            
            const q = room.questions[room.currentQ];
            const player = room.players[playerIndex];

            const blurAmount = answered ? 0 : Math.max(0, (time / 20) * 25);

            useEffect(() => {
                setTime(20);
                setAnswered(false);
                setResult(null);
                setInputs({ title: '', artist: '', movie: '' });

                if (audioRef.current) {
                    audioRef.current.pause();
                    audioRef.current.currentTime = 0;
                }
                setTimeout(() => audioRef.current?.play().catch(() => {}), 200);

                if (q.type === 'qcm') {
                    const qType = Math.random() > 0.5 ? 'artist' : 'title';
                    const correct = q[qType];
                    const opts = [correct];
                    const pool = shuffle(musicDB.filter(m => m[qType] !== correct));
                    
                    while (opts.length < 4 && pool.length > 0) {
                        const val = pool.pop()[qType];
                        if (!opts.includes(val)) opts.push(val);
                    }

                    setOptions(shuffle(opts));
                    setCorrectAns(correct);
                    setQText(qType === 'artist' ? "Qui est l'artiste ?" : "Quel est le titre ?");
                }

                timerRef.current = setInterval(() => {
                    setTime(prev => {
                        if (prev <= 1) {
                            clearInterval(timerRef.current);
                            if (!answered) submit(null, 0);
                            return 0;
                        }
                        return prev - 1;
                    });
                }, 1000);

                return () => {
                    clearInterval(timerRef.current);
                    if (audioRef.current) audioRef.current.pause();
                };
            }, [room.currentQ]);

            const submit = (answer, timeWhenAnswered = time) => {
                if (answered) return;
                setAnswered(true);
                clearInterval(timerRef.current);
                if (audioRef.current) audioRef.current.pause();

                let correct = false;
                let points = 0;
                let msg = '';

                if (q.type === 'qcm') {
                    correct = answer === correctAns;
                    points = correct ? (50 + timeWhenAnswered * 10) : 0;
                    msg = correct ? `üéâ Bravo ! +${points} pts` : `‚ùå C'√©tait : ${q.title} - ${q.artist}`;
                } else if (q.type === 'writing') {
                    const t = inputs.title.toLowerCase().trim();
                    const a = inputs.artist.toLowerCase().trim();
                    const titleOk = t && q.title.toLowerCase().includes(t.split(' ')[0]);
                    const artistOk = a && q.artist.toLowerCase().includes(a.split(' ')[0]);
                    
                    if (titleOk && artistOk) {
                        correct = true;
                        points = 50 + timeWhenAnswered * 10;
                        msg = `üéâ Parfait ! +${points} pts`;
                    } else if (titleOk) {
                        correct = true;
                        points = Math.floor((50 + timeWhenAnswered * 10) * 0.5);
                        msg = `üëç Bon titre ! +${points} pts (50%)`;
                    } else if (artistOk) {
                        correct = true;
                        points = Math.floor((50 + timeWhenAnswered * 10) * 0.5);
                        msg = `üëç Bon artiste ! +${points} pts (50%)`;
                    } else {
                        msg = `‚ùå C'√©tait : ${q.title} - ${q.artist}`;
                    }
                } else if (q.type === 'cinema') {
                    const movieInput = inputs.movie.toLowerCase().trim();
                    const movieTitle = q.movieTitle.toLowerCase();
                    correct = movieInput && (
                        movieTitle.includes(movieInput) || 
                        movieInput.includes(movieTitle.split(' ')[0])
                    );
                    points = correct ? (50 + timeWhenAnswered * 10) : 0;
                    msg = correct ? `üéâ Bravo ! +${points} pts` : `‚ùå C'√©tait : ${q.movieTitle}`;
                }

                setResult({ correct, msg });

                setTimeout(() => {
                    onAnswer(points);
                }, 2500);
            };

            return (
                <div className="screen game">
                    <div className="game-header">
                        <div className="timer">‚è±Ô∏è {time}s</div>
                        <div>Q {room.currentQ + 1}/{room.questions.length}</div>
                        <div className="score">üèÜ {player.score}</div>
                    </div>

                    <div className="img-box">
                        <img 
                            src={q.cover} 
                            alt="Cover" 
                            className="cover" 
                            style={{ filter: `blur(${blurAmount}px)` }}
                        />
                    </div>

                    <div className="audio-box">
                        <audio ref={audioRef} src={q.preview} loop />
                        <button className="audio-btn" onClick={() => {
                            if (audioRef.current?.paused) audioRef.current.play();
                            else audioRef.current?.pause();
                        }}>
                            üéµ {answered ? 'Arr√™ter' : 'Musique'}
                        </button>
                    </div>

                    <div className="question-box">
                        {q.type === 'qcm' && (
                            <>
                                <h3 className="q-text">{qText}</h3>
                                <div className="options">
                                    {options.map((opt, i) => (
                                        <button
                                            key={i}
                                            className={`opt ${result ? (opt === correctAns ? 'correct' : 'wrong') : ''}`}
                                            onClick={() => submit(opt, time)}
                                            disabled={answered}
                                        >
                                            {opt}
                                        </button>
                                    ))}
                                </div>
                            </>
                        )}

                        {q.type === 'writing' && (
                            <>
                                <h3 className="q-text">√âcris le titre et l'artiste</h3>
                                <input
                                    className="input"
                                    placeholder="Titre"
                                    value={inputs.title}
                                    onChange={(e) => setInputs({...inputs, title: e.target.value})}
                                    disabled={answered}
                                />
                                <input
                                    className="input"
                                    placeholder="Artiste"
                                    value={inputs.artist}
                                    onChange={(e) => setInputs({...inputs, artist: e.target.value})}
                                    disabled={answered}
                                />
                                {!answered && <Button onClick={() => submit(null, time)}>Valider</Button>}
                            </>
                        )}

                        {q.type === 'cinema' && (
                            <>
                                <h3 className="q-text">üé¨ De quel film vient cette musique ?</h3>
                                <input
                                    className="input"
                                    placeholder="Titre du film"
                                    value={inputs.movie}
                                    onChange={(e) => setInputs({...inputs, movie: e.target.value})}
                                    disabled={answered}
                                />
                                {!answered && <Button onClick={() => submit(null, time)}>Valider</Button>}
                            </>
                        )}

                        {result && (
                            <div className={`result ${result.correct ? 'correct' : 'wrong'}`}>
                                {result.msg}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // ===========================================
        // √âCRAN LEADERBOARD
        // ===========================================
        const LeaderboardScreen = ({ players, onRestart }) => {
            console.log('üèÜ LeaderboardScreen rendu avec players:', players);
            
            if (!players || players.length === 0) {
                console.error('‚ùå Pas de joueurs pour le leaderboard !');
                return (
                    <div className="screen">
                        <h2 className="screen-title">Chargement du classement...</h2>
                        <p style={{color: '#aaa', marginTop: '2rem'}}>
                            Si cet √©cran persiste, recharge la page
                        </p>
                    </div>
                );
            }

            const sorted = [...players].sort((a, b) => b.score - a.score);
            console.log('üìä Classement tri√©:', sorted);

            return (
                <div className="screen">
                    <h2 className="screen-title">üèÜ Classement Final üèÜ</h2>
                    
                    <div className="podium">
                        {sorted.slice(0, Math.min(3, sorted.length)).map((p, i) => (
                            <div key={i} className={`podium-item p${i+1}`}>
                                <div className="medal">{['ü•á','ü•à','ü•â'][i]}</div>
                                <div className="p-name">{p.name}</div>
                                <div className="p-score">{p.score} pts</div>
                            </div>
                        ))}
                    </div>

                    <div className="leaderboard">
                        {sorted.map((p, i) => (
                            <div key={i} className="lb-row">
                                <span className="rank">#{i+1}</span>
                                <span className="name">{p.name}</span>
                                <span className="pts">{p.score} pts</span>
                            </div>
                        ))}
                    </div>

                    <Button large onClick={onRestart}>üè† Nouvelle partie</Button>
                </div>
            );
        };

        // ===========================================
        // APP PRINCIPALE
        // ===========================================
        const App = () => {
            const [screen, setScreen] = useState('home');
            const [mode, setMode] = useState(null);
            const [playerName, setPlayerName] = useState('');
            const [numQuestions, setNumQuestions] = useState(10);
            const [room, setRoom] = useState(null);
            const [playerIdx, setPlayerIdx] = useState(0);
            const [isHost, setIsHost] = useState(false);
            const [deezer] = useState(new DeezerAPI());
            const [gemini] = useState(new GeminiFilmDetector(GEMINI_API_KEY));
            const [musicDB, setMusicDB] = useState([]);
            const [movieMusicDB, setMovieMusicDB] = useState([]);

            const pollRef = useRef(null);

            useEffect(() => {
                if (room?.code) {
                    pollRef.current = setInterval(() => {
                        const latest = storage.get(`room:${room.code}`);
                        if (latest) {
                            setRoom(latest);
                            if (latest.started && screen === 'lobby') setScreen('game');
                            if (latest.currentQ >= latest.questions.length && screen === 'game') {
                                console.log('üèÜ Partie termin√©e ! Affichage du leaderboard...');
                                setScreen('leaderboard');
                                clearInterval(pollRef.current);
                            }
                        }
                    }, 1000);
                }
                return () => clearInterval(pollRef.current);
            }, [room?.code, screen]);

            const handleStart = (selectedMode, name, numQs) => {
                setMode(selectedMode);
                setPlayerName(name);
                setNumQuestions(numQs);
                setScreen('join');
            };

            const handleLoadDeezerData = async (type, param) => {
                try {
                    let tracks = [];
                    
                    if (type === 'chart') {
                        tracks = await deezer.getChart(50);
                        if (tracks.length > 0) {
                            setMusicDB(tracks);
                            alert(`‚úÖ Top 50 charg√© ! ${tracks.length} morceaux pr√™ts üéµ`);
                        }
                    } else if (type === 'search') {
                        tracks = await deezer.searchTracks(param, 50);
                        if (tracks.length > 0) {
                            setMusicDB(tracks);
                            alert(`‚úÖ ${tracks.length} morceaux trouv√©s üéµ`);
                        }
                    } else if (type === 'playlist') {
                        tracks = await deezer.getPlaylistTracks(param);
                        if (tracks.length > 0) {
                            setMusicDB(tracks);
                            alert(`‚úÖ Playlist charg√©e ! ${tracks.length} morceaux pr√™ts üéµ`);
                        }
                    }
                    
                    if (tracks.length === 0) {
                        alert('‚ùå Aucun morceau trouv√©');
                    }
                } catch (error) {
                    console.error('Erreur Deezer:', error);
                    alert(`‚ùå Erreur : ${error.message}`);
                }
            };

            const handleLoadMovieMusic = async (playlistId) => {
                try {
                    console.log('üé¨ Chargement de la playlist films...');
                    const tracks = await deezer.getPlaylistTracks(playlistId);
                    
                    if (tracks.length === 0) {
                        alert('‚ùå Playlist vide');
                        return;
                    }

                    console.log(`üìÄ ${tracks.length} morceaux charg√©s, analyse en cours...`);
                    
                    // Utiliser Gemini pour d√©tecter les films
                    const movietracks = await gemini.detectMoviesFromTracks(tracks);
                    
                    // Filtrer seulement ceux qui sont des films
                    const validMovies = movietracks.filter(t => 
                        t.movieTitle && 
                        t.movieTitle !== t.title && 
                        t.movieTitle.toLowerCase() !== 'non'
                    );
                    
                    setMovieMusicDB(validMovies);
                    
                    const aiDetected = movietracks.filter(t => t.detectedByAI).length;
                    const manualDetected = validMovies.length - aiDetected;
                    
                    let message = `‚úÖ Playlist films charg√©e !\n\n`;
                    message += `üé¨ ${validMovies.length} musiques de films d√©tect√©es sur ${tracks.length}\n\n`;
                    if (aiDetected > 0) {
                        message += `ü§ñ ${aiDetected} d√©tect√©s par IA Gemini\n`;
                    }
                    if (manualDetected > 0) {
                        message += `üìã ${manualDetected} d√©tect√©s par mapping manuel`;
                    }
                    
                    alert(message);
                    
                    if (validMovies.length === 0) {
                        alert('‚ö†Ô∏è Aucune musique de film d√©tect√©e dans cette playlist.\n\nEssaie une playlist avec des bandes originales de films !');
                    }
                } catch (error) {
                    console.error('Erreur:', error);
                    alert(`‚ùå Erreur : ${error.message}`);
                }
            };

            const createRoom = () => {
                const code = genCode();
                const questionsDB = mode === 'cinema' ? movieMusicDB : musicDB;
                
                if (questionsDB.length === 0) {
                    alert('‚ö†Ô∏è Charge d\'abord des morceaux avec Deezer !');
                    setScreen('home');
                    return;
                }

                const newRoom = {
                    code,
                    mode,
                    host: playerName,
                    players: [{ name: playerName, score: 0 }],
                    questions: prepareQuestions(mode, musicDB, numQuestions, movieMusicDB),
                    currentQ: 0,
                    started: false
                };
                
                console.log('üéÆ Partie cr√©√©e:', newRoom);
                storage.set(`room:${code}`, newRoom);
                setRoom(newRoom);
                setPlayerIdx(0);
                setIsHost(true);
                setScreen('lobby');
            };

            const joinRoom = (code) => {
                const existing = storage.get(`room:${code}`);
                if (!existing) { alert('Code invalide !'); return; }
                if (existing.started) { alert('Partie d√©j√† lanc√©e !'); return; }

                existing.players.push({ name: playerName, score: 0 });
                storage.set(`room:${code}`, existing);
                setRoom(existing);
                setPlayerIdx(existing.players.length - 1);
                setIsHost(false);
                setScreen('lobby');
            };

            const startGame = () => {
                const updated = { ...room, started: true };
                storage.set(`room:${room.code}`, updated);
                setRoom(updated);
                setScreen('game');
            };

            const handleAnswer = (points) => {
                const updated = { ...room };
                updated.players[playerIdx].score += points;
                updated.currentQ += 1;
                
                console.log(`üìä Question ${updated.currentQ}/${updated.questions.length}`);
                console.log('üéÆ Room mise √† jour:', updated);
                
                storage.set(`room:${room.code}`, updated);
                setRoom(updated);

                if (updated.currentQ >= updated.questions.length) {
                    console.log('üèÜ FIN DE PARTIE ! Affichage leaderboard...');
                    console.log('üë• Joueurs finaux:', updated.players);
                    
                    // Forcer le passage au leaderboard avec les bonnes donn√©es
                    setTimeout(() => {
                        const finalRoom = storage.get(`room:${room.code}`);
                        console.log('üì¶ Room r√©cup√©r√©e du storage:', finalRoom);
                        setRoom(finalRoom);
                        setScreen('leaderboard');
                    }, 1000);
                }
            };

            const restart = () => {
                if (pollRef.current) clearInterval(pollRef.current);
                setScreen('home');
                setRoom(null);
                setMode(null);
                setPlayerName('');
            };

            return (
                <div className="app">
                    <div className="bg"></div>
                    {screen === 'home' && (
                        <HomeScreen 
                            onStart={handleStart}
                            onLoadDeezerData={handleLoadDeezerData}
                            onLoadMovieMusic={handleLoadMovieMusic}
                        />
                    )}
                    {screen === 'join' && (
                        <JoinScreen 
                            onCreateRoom={createRoom}
                            onJoinRoom={joinRoom}
                            onBack={() => setScreen('home')}
                        />
                    )}
                    {screen === 'lobby' && room && (
                        <LobbyScreen 
                            room={room}
                            isHost={isHost}
                            onStart={startGame}
                        />
                    )}
                    {screen === 'game' && room && (
                        <GameScreen 
                            room={room}
                            playerIndex={playerIdx}
                            onAnswer={handleAnswer}
                            musicDB={musicDB.length > 0 ? musicDB : movieMusicDB}
                        />
                    )}
                    {screen === 'leaderboard' && room && (
                        <LeaderboardScreen 
                            players={room.players}
                            onRestart={restart}
                        />
                    )}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background: #0a0e27;
            color: white;
        }

        .app {
            min-height: 100vh;
            position: relative;
        }

        .bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255, 0, 110, 0.1), transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(131, 56, 236, 0.1), transparent 50%);
            animation: pulse 8s infinite;
            z-index: 0;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.8; }
        }

        .screen {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .screen.game {
            justify-content: flex-start;
            padding-top: 1rem;
        }

        .logo {
            text-align: center;
            margin-bottom: 2rem;
        }

        .title {
            font-family: 'Bungee Shade', cursive;
            font-size: 4rem;
            background: linear-gradient(45deg, #ff006e, #00f5ff, #ffbe0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #00f5ff;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            margin-top: 0.5rem;
        }

        .deezer-banner {
            background: #1a1f3a;
            border: 2px solid #8338ec;
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            max-width: 1000px;
            width: 100%;
        }

        .deezer-banner h3 {
            color: #ffbe0b;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .deezer-banner > p {
            text-align: center;
            color: #aaa;
            margin-bottom: 1.5rem;
        }

        .gemini-warning {
            background: rgba(255, 190, 11, 0.1);
            border: 2px solid #ffbe0b;
            border-radius: 15px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .gemini-warning p {
            margin: 0;
            color: #ffbe0b;
        }

        .gemini-warning a {
            color: #00f5ff;
            text-decoration: none;
            font-weight: 800;
        }

        .gemini-warning a:hover {
            text-decoration: underline;
        }

        .gemini-success {
            background: rgba(0, 255, 100, 0.1);
            border: 2px solid #00ff64;
            border-radius: 15px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .gemini-success p {
            margin: 0;
            color: #00ff64;
        }

        .deezer-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1rem;
        }

        .deezer-option {
            background: rgba(0, 0, 0, 0.3);
            padding: 1.2rem;
            border-radius: 15px;
            border: 2px solid #8338ec;
        }

        .deezer-option.cinema {
            border-color: #ff006e;
        }

        .deezer-option h4 {
            color: #ff006e;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .deezer-option p {
            color: #aaa;
            font-size: 0.85rem;
            margin-bottom: 0.8rem;
        }

        .deezer-input {
            width: 100%;
            padding: 0.7rem;
            margin-bottom: 0.7rem;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #8338ec;
            border-radius: 10px;
            color: white;
            font-size: 0.9rem;
            font-family: 'Montserrat', sans-serif;
        }

        .deezer-input:focus {
            outline: none;
            border-color: #ff006e;
        }

        .name-input {
            width: 100%;
            max-width: 400px;
            padding: 1.2rem;
            margin-bottom: 2rem;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #8338ec;
            border-radius: 15px;
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
            text-align: center;
            font-family: 'Montserrat', sans-serif;
        }

        .name-input:focus {
            outline: none;
            border-color: #ff006e;
        }

        .num-questions-selector {
            text-align: center;
            margin-bottom: 2rem;
            background: #1a1f3a;
            padding: 1.5rem;
            border-radius: 15px;
            border: 2px solid #8338ec;
            max-width: 600px;
            width: 100%;
        }

        .num-questions-selector label {
            display: block;
            color: #ffbe0b;
            font-size: 1.2rem;
            font-weight: 800;
            margin-bottom: 1rem;
        }

        .num-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .num-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid #8338ec;
            color: white;
            padding: 0.8rem 1.5rem;
            font-size: 1.1rem;
            font-weight: 800;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Montserrat', sans-serif;
        }

        .num-btn:hover {
            background: rgba(131, 56, 236, 0.2);
            transform: scale(1.05);
        }

        .num-btn.active {
            background: linear-gradient(135deg, #ff006e, #8338ec);
            border-color: #ff006e;
        }

        .mode-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            width: 100%;
            max-width: 900px;
        }

        .mode-card {
            background: #1a1f3a;
            border: 3px solid transparent;
            border-radius: 20px;
            padding: 2rem;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .mode-card:hover {
            transform: translateY(-10px);
            border-color: #ff006e;
        }

        .mode-card.special {
            grid-column: 1 / -1;
        }

        .mode-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .mode-title {
            font-size: 1.5rem;
            font-weight: 800;
            color: #ffbe0b;
            margin-bottom: 0.5rem;
        }

        .mode-desc {
            color: #aaa;
        }

        .warning {
            margin-top: 2rem;
            color: #ff006e;
            font-weight: 600;
        }

        .screen-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: #ffbe0b;
            margin-bottom: 2rem;
        }

        .join-grid {
            display: flex;
            gap: 2rem;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 800px;
        }

        .join-card {
            background: #1a1f3a;
            border: 2px solid #8338ec;
            border-radius: 20px;
            padding: 2rem;
            flex: 1;
            min-width: 300px;
            text-align: center;
        }

        .join-card h3 {
            color: #ff006e;
            margin-bottom: 1rem;
        }

        .join-divider {
            font-size: 1.5rem;
            font-weight: 800;
            color: #00f5ff;
        }

        .code-input {
            width: 100%;
            padding: 1rem;
            margin: 1rem 0;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #8338ec;
            border-radius: 10px;
            color: white;
            font-size: 1.8rem;
            font-weight: 800;
            text-align: center;
            letter-spacing: 0.3em;
            text-transform: uppercase;
        }

        .btn {
            background: linear-gradient(135deg, #ff006e, #8338ec);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            font-weight: 800;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Montserrat', sans-serif;
            margin: 0.3rem;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-3px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn.secondary {
            background: linear-gradient(135deg, #00f5ff, #ffbe0b);
        }

        .btn.large {
            padding: 1.5rem 3rem;
            font-size: 1.3rem;
            margin-top: 2rem;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #8338ec;
            margin-top: 2rem;
        }

        .code-display {
            text-align: center;
            margin-bottom: 2rem;
        }

        .code-label {
            color: #aaa;
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .code-value {
            font-size: 3rem;
            font-weight: 800;
            color: #ffbe0b;
            letter-spacing: 0.2em;
        }

        .players-box {
            background: #1a1f3a;
            border: 2px solid #8338ec;
            border-radius: 20px;
            padding: 2rem;
            width: 100%;
            max-width: 600px;
            margin-bottom: 2rem;
        }

        .players-box h3 {
            color: #00f5ff;
            margin-bottom: 1rem;
        }

        .player {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .player-num {
            background: #8338ec;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
        }

        .player-name {
            flex: 1;
            font-weight: 600;
        }

        .waiting {
            text-align: center;
            margin-top: 2rem;
            font-size: 1.2rem;
            color: #ffbe0b;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 800px;
            margin-bottom: 1.5rem;
            background: #1a1f3a;
            padding: 1rem 1.5rem;
            border-radius: 15px;
            border: 2px solid #8338ec;
            font-weight: 800;
        }

        .timer {
            color: #ff006e;
            font-size: 1.3rem;
        }

        .score {
            color: #ffbe0b;
            font-size: 1.3rem;
        }

        .img-box {
            width: 100%;
            max-width: 400px;
            margin: 0 auto 1.5rem;
            border-radius: 20px;
            overflow: hidden;
        }

        .cover {
            width: 100%;
            height: 400px;
            object-fit: cover;
            transition: filter 0.3s ease;
        }

        .audio-box {
            text-align: center;
            margin: 1rem 0;
        }

        .audio-btn {
            background: linear-gradient(135deg, #ffbe0b, #ff006e);
            color: white;
            border: none;
            padding: 0.8rem 2rem;
            font-size: 1rem;
            font-weight: 800;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
        }

        .question-box {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }

        .q-text {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 800;
            color: #00f5ff;
            margin-bottom: 1.5rem;
        }

        .options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .opt {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid #8338ec;
            padding: 1.5rem;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .opt:hover:not(:disabled) {
            background: rgba(131, 56, 236, 0.2);
            transform: scale(1.05);
        }

        .opt.correct {
            background: rgba(0, 255, 100, 0.2);
            border-color: #00ff64;
        }

        .opt.wrong {
            background: rgba(255, 0, 0, 0.2);
            border-color: #ff0033;
        }

        .input {
            width: 100%;
            padding: 1rem;
            margin-bottom: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #8338ec;
            border-radius: 10px;
            color: white;
            font-size: 1.1rem;
            font-family: 'Montserrat', sans-serif;
        }

        .input:focus {
            outline: none;
            border-color: #ff006e;
        }

        .result {
            margin-top: 1.5rem;
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            font-size: 1.3rem;
            font-weight: 800;
        }

        .result.correct {
            background: rgba(0, 255, 100, 0.2);
            border: 2px solid #00ff64;
            color: #00ff64;
        }

        .result.wrong {
            background: rgba(255, 0, 0, 0.2);
            border: 2px solid #ff0033;
            color: #ff6b6b;
        }

        .podium {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .podium-item {
            background: #1a1f3a;
            border: 3px solid #8338ec;
            border-radius: 20px;
            padding: 2rem 1.5rem;
            text-align: center;
            min-width: 150px;
        }

        .podium-item.p1 {
            border-color: #FFD700;
            transform: scale(1.1);
        }

        .podium-item.p2 {
            border-color: #C0C0C0;
        }

        .podium-item.p3 {
            border-color: #CD7F32;
        }

        .medal {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .p-name {
            font-weight: 800;
            font-size: 1.2rem;
            color: #ffbe0b;
            margin-bottom: 0.5rem;
        }

        .p-score {
            font-size: 1.5rem;
            font-weight: 800;
            color: #ff006e;
        }

        .leaderboard {
            background: #1a1f3a;
            border: 2px solid #8338ec;
            border-radius: 20px;
            padding: 1.5rem;
            width: 100%;
            max-width: 600px;
            margin: 2rem 0;
        }

        .lb-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-bottom: 0.5rem;
        }

        .rank {
            background: #8338ec;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
        }

        .name {
            flex: 1;
            font-weight: 600;
        }

        .pts {
            font-weight: 800;
            color: #ffbe0b;
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .title { font-size: 2.5rem; }
            .mode-grid { grid-template-columns: 1fr; }
            .options { grid-template-columns: 1fr; }
            .join-grid { flex-direction: column; }
            .deezer-options { grid-template-columns: 1fr; }
        }
    </style>
</body>
</html>
